<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    
    <!-- å¾®ä¿¡åˆ†äº«ä¼˜åŒ– -->
    <meta property="og:title" content="å°ä¼ä¸šè´¢åŠ¡è®°è´¦ç³»ç»Ÿ">
    <meta property="og:description" content="ç®€å•æ˜“ç”¨çš„ä¼ä¸šè´¢åŠ¡ç®¡ç†å·¥å…·">
    <meta property="og:image" content="https://via.placeholder.com/300x300.png?text=è´¢åŠ¡è®°è´¦">
    
    <title>è´¢åŠ¡è®°è´¦</title>
    
    <!-- PWA manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIuWwj+S8geS4muiigOWKoemXreiusOizpuezuyIsCiAgInNob3J0X25hbWUiOiAi6LSi5Yqh6K6w6LSmIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmZmZmZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjMzU3MEZGIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpBd0lpQm9aV2xuYUhROUlqSXdNQ0lnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JajQ4Y21WamRDQjNhV1IwYUQwaU1qQXdJaUJvWldsbmFIUTlJakl3TUNJZ1ptbHNiRDBpSXpNMU56QkdSaUl2UGp4MFpYaDBJSGc5SWpVd0pTSWdlVDBpTlRBbElpQm1hV3hzUFNJamRHWm1JaUJtYjI1MExYTnBlbVU5SWpZd0lpQjBaWGgwTFdGdVkyaHZjajBpYldsa1pHeGxJajQ4TDNSbGVIUStQQzl6ZG1jKyIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0KICBdCn0=">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* ç§»åŠ¨ç«¯ä¼˜åŒ–æ ·å¼ */
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }
        
        /* åº•éƒ¨å¯¼èˆªå›ºå®š */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            padding-bottom: env(safe-area-inset-bottom);
            z-index: 50;
        }
        
        /* å†…å®¹åŒºåŸŸåº•éƒ¨ç•™ç™½ */
        .content-with-nav {
            padding-bottom: calc(70px + env(safe-area-inset-bottom));
        }
        
        /* æ¨¡æ€æ¡†ä¼˜åŒ– */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
        }
        
        .modal-content {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            max-height: 85vh;
            overflow-y: auto;
            z-index: 101;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* è§¦æ‘¸ä¼˜åŒ–æŒ‰é’® */
        .touch-btn {
            min-height: 44px;
            min-width: 44px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // é»˜è®¤åˆ†ç±»
        const DEFAULT_CATEGORIES = {
            income: ['é”€å”®æ”¶å…¥', 'æœåŠ¡æ”¶å…¥', 'æŠ•èµ„æ”¶ç›Š', 'å…¶ä»–æ”¶å…¥'],
            expense: ['å·¥èµ„æ”¯å‡º', 'æˆ¿ç§Ÿ', 'æ°´ç”µè´¹', 'åŠå…¬ç”¨å“', 'å·®æ—…è´¹', 'è¥é”€è´¹ç”¨', 'é‡‡è´­æˆæœ¬', 'å…¶ä»–æ”¯å‡º']
        };

        function FinanceTracker() {
            const [transactions, setTransactions] = useState([]);
            const [categories, setCategories] = useState(DEFAULT_CATEGORIES);
            const [showModal, setShowModal] = useState(false);
            const [currentView, setCurrentView] = useState('dashboard');
            const [editingTransaction, setEditingTransaction] = useState(null);
            const [showInstallPrompt, setShowInstallPrompt] = useState(false);
            
            // è¡¨å•çŠ¶æ€
            const [formData, setFormData] = useState({
                type: 'expense',
                amount: '',
                category: '',
                date: new Date().toISOString().split('T')[0],
                description: '',
                paymentMethod: 'ç°é‡‘'
            });

            // ç­›é€‰çŠ¶æ€
            const [filters, setFilters] = useState({
                type: 'all',
                category: 'all',
                dateRange: 'all', // all, today, week, month, custom
                searchTerm: ''
            });

            // åŠ è½½æ•°æ®
            useEffect(() => {
                const savedTransactions = localStorage.getItem('transactions');
                const savedCategories = localStorage.getItem('categories');
                
                if (savedTransactions) {
                    setTransactions(JSON.parse(savedTransactions));
                }
                if (savedCategories) {
                    setCategories(JSON.parse(savedCategories));
                }
                
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥å®‰è£…PWA
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    setShowInstallPrompt(true);
                });
            }, []);

            // ä¿å­˜æ•°æ®
            useEffect(() => {
                localStorage.setItem('transactions', JSON.stringify(transactions));
            }, [transactions]);

            useEffect(() => {
                localStorage.setItem('categories', JSON.stringify(categories));
            }, [categories]);

            // è®¡ç®—æ—¥æœŸèŒƒå›´
            const getDateRange = (range) => {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                switch (range) {
                    case 'today':
                        return {
                            start: today.toISOString().split('T')[0],
                            end: today.toISOString().split('T')[0]
                        };
                    case 'week':
                        const weekStart = new Date(today);
                        weekStart.setDate(today.getDate() - today.getDay());
                        return {
                            start: weekStart.toISOString().split('T')[0],
                            end: today.toISOString().split('T')[0]
                        };
                    case 'month':
                        const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                        return {
                            start: monthStart.toISOString().split('T')[0],
                            end: today.toISOString().split('T')[0]
                        };
                    default:
                        return null;
                }
            };

            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            const statistics = useMemo(() => {
                const dateRange = getDateRange(filters.dateRange);
                
                const filtered = transactions.filter(t => {
                    const matchType = filters.type === 'all' || t.type === filters.type;
                    const matchCategory = filters.category === 'all' || t.category === filters.category;
                    const matchSearch = !filters.searchTerm || 
                                      t.description.toLowerCase().includes(filters.searchTerm.toLowerCase());
                    
                    let matchDate = true;
                    if (dateRange) {
                        matchDate = t.date >= dateRange.start && t.date <= dateRange.end;
                    }
                    
                    return matchType && matchCategory && matchDate && matchSearch;
                });

                const income = filtered
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + parseFloat(t.amount), 0);
                
                const expense = filtered
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + parseFloat(t.amount), 0);

                // æŒ‰åˆ†ç±»ç»Ÿè®¡
                const categoryStats = {};
                filtered.forEach(t => {
                    if (!categoryStats[t.category]) {
                        categoryStats[t.category] = { income: 0, expense: 0 };
                    }
                    categoryStats[t.category][t.type] += parseFloat(t.amount);
                });

                // æŒ‰æ—¥æœŸåˆ†ç»„ï¼ˆæœ€è¿‘7å¤©ï¼‰
                const recentDays = {};
                const last7Days = Array.from({length: 7}, (_, i) => {
                    const d = new Date();
                    d.setDate(d.getDate() - i);
                    return d.toISOString().split('T')[0];
                }).reverse();
                
                last7Days.forEach(date => {
                    recentDays[date] = { income: 0, expense: 0 };
                });
                
                filtered.forEach(t => {
                    if (recentDays[t.date] !== undefined) {
                        recentDays[t.date][t.type] += parseFloat(t.amount);
                    }
                });

                return {
                    income,
                    expense,
                    balance: income - expense,
                    categoryStats,
                    recentDays,
                    filteredTransactions: filtered.sort((a, b) => 
                        new Date(b.date) - new Date(a.date) || b.id - a.id
                    )
                };
            }, [transactions, filters]);

            // æ·»åŠ /ç¼–è¾‘äº¤æ˜“
            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.amount || !formData.category) {
                    alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                    return;
                }

                const transaction = {
                    ...formData,
                    amount: parseFloat(formData.amount),
                    id: editingTransaction?.id || Date.now(),
                    createdAt: editingTransaction?.createdAt || new Date().toISOString()
                };

                if (editingTransaction) {
                    setTransactions(transactions.map(t => 
                        t.id === editingTransaction.id ? transaction : t
                    ));
                } else {
                    setTransactions([transaction, ...transactions]);
                }

                resetForm();
            };

            const resetForm = () => {
                setFormData({
                    type: 'expense',
                    amount: '',
                    category: '',
                    date: new Date().toISOString().split('T')[0],
                    description: '',
                    paymentMethod: 'ç°é‡‘'
                });
                setEditingTransaction(null);
                setShowModal(false);
            };

            const handleEdit = (transaction) => {
                setEditingTransaction(transaction);
                setFormData(transaction);
                setShowModal(true);
            };

            const handleDelete = (id) => {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                    setTransactions(transactions.filter(t => t.id !== id));
                }
            };

            // å¿«é€Ÿæ·»åŠ 
            const quickAdd = (type) => {
                setFormData({
                    ...formData,
                    type: type,
                    amount: '',
                    category: ''
                });
                setShowModal(true);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50">
                    {/* å¤´éƒ¨ - ç§»åŠ¨ç«¯ä¼˜åŒ– */}
                    <header className="bg-white shadow-sm sticky top-0 z-40">
                        <div className="px-4 py-3">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-2">
                                    <div className="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                                        <span className="text-white text-lg font-bold">è´¢</span>
                                    </div>
                                    <h1 className="text-lg font-bold text-gray-800">è´¢åŠ¡è®°è´¦</h1>
                                </div>
                                <button
                                    onClick={() => setShowModal(true)}
                                    className="touch-btn px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg shadow-md active:scale-95 transition"
                                >
                                    â• è®°ä¸€ç¬”
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* ä¸»å†…å®¹åŒº */}
                    <main className="content-with-nav pb-4">
                        {currentView === 'dashboard' && (
                            <DashboardView 
                                statistics={statistics} 
                                onQuickAdd={quickAdd}
                            />
                        )}
                        
                        {currentView === 'transactions' && (
                            <TransactionsView
                                transactions={statistics.filteredTransactions}
                                filters={filters}
                                setFilters={setFilters}
                                categories={categories}
                                onEdit={handleEdit}
                                onDelete={handleDelete}
                            />
                        )}
                        
                        {currentView === 'reports' && (
                            <ReportsView statistics={statistics} />
                        )}
                        
                        {currentView === 'settings' && (
                            <SettingsView 
                                transactions={transactions}
                                setTransactions={setTransactions}
                                categories={categories}
                                setCategories={setCategories}
                            />
                        )}
                    </main>

                    {/* åº•éƒ¨å¯¼èˆª */}
                    <nav className="bottom-nav">
                        <div className="grid grid-cols-4 h-16">
                            <NavButton
                                icon="ğŸ“Š"
                                label="é¦–é¡µ"
                                active={currentView === 'dashboard'}
                                onClick={() => setCurrentView('dashboard')}
                            />
                            <NavButton
                                icon="ğŸ“"
                                label="è®°å½•"
                                active={currentView === 'transactions'}
                                onClick={() => setCurrentView('transactions')}
                            />
                            <NavButton
                                icon="ğŸ“ˆ"
                                label="æŠ¥è¡¨"
                                active={currentView === 'reports'}
                                onClick={() => setCurrentView('reports')}
                            />
                            <NavButton
                                icon="âš™ï¸"
                                label="è®¾ç½®"
                                active={currentView === 'settings'}
                                onClick={() => setCurrentView('settings')}
                            />
                        </div>
                    </nav>

                    {/* æ·»åŠ /ç¼–è¾‘æ¨¡æ€æ¡† */}
                    {showModal && (
                        <TransactionModal
                            formData={formData}
                            setFormData={setFormData}
                            categories={categories}
                            setCategories={setCategories}
                            onSubmit={handleSubmit}
                            onClose={resetForm}
                            isEditing={!!editingTransaction}
                        />
                    )}
                </div>
            );
        }

        // åº•éƒ¨å¯¼èˆªæŒ‰é’®
        function NavButton({ icon, label, active, onClick }) {
            return (
                <button
                    onClick={onClick}
                    className={`flex flex-col items-center justify-center space-y-1 touch-btn transition ${
                        active ? 'text-blue-600' : 'text-gray-500'
                    }`}
                >
                    <span className="text-xl">{icon}</span>
                    <span className="text-xs font-medium">{label}</span>
                </button>
            );
        }

        // ä»ªè¡¨ç›˜è§†å›¾
        function DashboardView({ statistics, onQuickAdd }) {
            return (
                <div className="p-4 space-y-4">
                    {/* ç»Ÿè®¡å¡ç‰‡ */}
                    <div className="grid grid-cols-2 gap-3">
                        <StatCard
                            title="æœ¬æœˆæ”¶å…¥"
                            amount={statistics.income}
                            icon="ğŸ’°"
                            color="green"
                        />
                        <StatCard
                            title="æœ¬æœˆæ”¯å‡º"
                            amount={statistics.expense}
                            icon="ğŸ’¸"
                            color="red"
                        />
                    </div>
                    
                    <div className="bg-white rounded-xl shadow-md p-4">
                        <div className="flex items-center justify-between mb-2">
                            <span className="text-sm text-gray-600">å‡€æ”¶ç›Š</span>
                            <span className={`text-2xl font-bold ${
                                statistics.balance >= 0 ? 'text-green-600' : 'text-red-600'
                            }`}>
                                Â¥{Math.abs(statistics.balance).toLocaleString('zh-CN', { 
                                    minimumFractionDigits: 2,
                                    maximumFractionDigits: 2 
                                })}
                            </span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2">
                            <div
                                className={`h-2 rounded-full transition-all duration-500 ${
                                    statistics.balance >= 0 ? 'bg-green-500' : 'bg-red-500'
                                }`}
                                style={{
                                    width: `${Math.min(Math.abs(statistics.balance) / (statistics.income || 1) * 100, 100)}%`
                                }}
                            ></div>
                        </div>
                    </div>

                    {/* å¿«é€Ÿæ“ä½œ */}
                    <div className="bg-white rounded-xl shadow-md p-4">
                        <h3 className="text-sm font-semibold text-gray-700 mb-3">å¿«é€Ÿè®°è´¦</h3>
                        <div className="grid grid-cols-2 gap-3">
                            <button
                                onClick={() => onQuickAdd('income')}
                                className="touch-btn py-3 bg-green-50 text-green-700 rounded-lg border-2 border-green-200 active:scale-95 transition"
                            >
                                <div className="text-2xl mb-1">ğŸ’°</div>
                                <div className="text-sm font-medium">æ·»åŠ æ”¶å…¥</div>
                            </button>
                            <button
                                onClick={() => onQuickAdd('expense')}
                                className="touch-btn py-3 bg-red-50 text-red-700 rounded-lg border-2 border-red-200 active:scale-95 transition"
                            >
                                <div className="text-2xl mb-1">ğŸ’¸</div>
                                <div className="text-sm font-medium">æ·»åŠ æ”¯å‡º</div>
                            </button>
                        </div>
                    </div>

                    {/* åˆ†ç±»ç»Ÿè®¡ */}
                    <div className="bg-white rounded-xl shadow-md p-4">
                        <h3 className="text-sm font-semibold text-gray-700 mb-3">åˆ†ç±»ç»Ÿè®¡</h3>
                        <div className="space-y-2">
                            {Object.entries(statistics.categoryStats)
                                .sort((a, b) => (b[1].expense + b[1].income) - (a[1].expense + a[1].income))
                                .slice(0, 5)
                                .map(([category, stats]) => (
                                    <CategoryStatItem
                                        key={category}
                                        category={category}
                                        income={stats.income}
                                        expense={stats.expense}
                                    />
                                ))}
                        </div>
                    </div>

                    {/* æœ€è¿‘è®°å½• */}
                    <div className="bg-white rounded-xl shadow-md p-4">
                        <h3 className="text-sm font-semibold text-gray-700 mb-3">æœ€è¿‘è®°å½•</h3>
                        <div className="space-y-2">
                            {statistics.filteredTransactions.slice(0, 5).map(t => (
                                <RecentTransactionItem key={t.id} transaction={t} />
                            ))}
                            {statistics.filteredTransactions.length === 0 && (
                                <div className="text-center text-gray-400 py-4">æš‚æ— è®°å½•</div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // ç»Ÿè®¡å¡ç‰‡
        function StatCard({ title, amount, icon, color }) {
            const colorClasses = {
                green: 'from-green-400 to-emerald-500',
                red: 'from-red-400 to-rose-500'
            };

            return (
                <div className="bg-white rounded-xl shadow-md p-4 slide-in">
                    <div className="flex items-start justify-between mb-2">
                        <p className="text-xs text-gray-600">{title}</p>
                        <div className={`w-10 h-10 bg-gradient-to-br ${colorClasses[color]} rounded-lg flex items-center justify-center text-xl`}>
                            {icon}
                        </div>
                    </div>
                    <p className="text-2xl font-bold text-gray-800">
                        Â¥{amount.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                    </p>
                </div>
            );
        }

        // åˆ†ç±»ç»Ÿè®¡é¡¹
        function CategoryStatItem({ category, income, expense }) {
            const total = expense || income;
            
            return (
                <div className="flex items-center justify-between py-2 border-b border-gray-100 last:border-0">
                    <div className="flex-1">
                        <div className="text-sm font-medium text-gray-800">{category}</div>
                        <div className="text-xs text-gray-500">
                            {income > 0 && `æ”¶ Â¥${income.toFixed(0)}`}
                            {expense > 0 && `æ”¯ Â¥${expense.toFixed(0)}`}
                        </div>
                    </div>
                    <div className={`text-sm font-bold ${expense > 0 ? 'text-red-600' : 'text-green-600'}`}>
                        Â¥{total.toFixed(0)}
                    </div>
                </div>
            );
        }

        // æœ€è¿‘äº¤æ˜“é¡¹
        function RecentTransactionItem({ transaction }) {
            return (
                <div className="flex items-center justify-between py-2 border-b border-gray-100 last:border-0">
                    <div className="flex-1 min-w-0">
                        <div className="flex items-center space-x-2">
                            <span className={`text-lg ${
                                transaction.type === 'income' ? 'ğŸ’°' : 'ğŸ’¸'
                            }`}>
                                {transaction.type === 'income' ? 'ğŸ’°' : 'ğŸ’¸'}
                            </span>
                            <div className="flex-1 min-w-0">
                                <div className="text-sm font-medium text-gray-800 truncate">
                                    {transaction.category}
                                </div>
                                <div className="text-xs text-gray-500">
                                    {transaction.date}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className={`text-sm font-bold ml-2 ${
                        transaction.type === 'income' ? 'text-green-600' : 'text-red-600'
                    }`}>
                        {transaction.type === 'income' ? '+' : '-'}Â¥{transaction.amount.toFixed(2)}
                    </div>
                </div>
            );
        }

        // äº¤æ˜“è®°å½•è§†å›¾
        function TransactionsView({ transactions, filters, setFilters, categories, onEdit, onDelete }) {
            return (
                <div className="p-4 space-y-4">
                    {/* ç­›é€‰å™¨ */}
                    <div className="bg-white rounded-xl shadow-md p-4 space-y-3">
                        <div className="flex gap-2 overflow-x-auto pb-2">
                            {['all', 'today', 'week', 'month'].map(range => (
                                <button
                                    key={range}
                                    onClick={() => setFilters({ ...filters, dateRange: range })}
                                    className={`touch-btn px-4 py-2 rounded-lg whitespace-nowrap text-sm transition ${
                                        filters.dateRange === range
                                            ? 'bg-blue-500 text-white'
                                            : 'bg-gray-100 text-gray-700'
                                    }`}
                                >
                                    {range === 'all' && 'å…¨éƒ¨'}
                                    {range === 'today' && 'ä»Šå¤©'}
                                    {range === 'week' && 'æœ¬å‘¨'}
                                    {range === 'month' && 'æœ¬æœˆ'}
                                </button>
                            ))}
                        </div>
                        
                        <div className="grid grid-cols-2 gap-2">
                            <select
                                value={filters.type}
                                onChange={(e) => setFilters({ ...filters, type: e.target.value })}
                                className="touch-btn px-3 py-2 border border-gray-300 rounded-lg text-sm"
                            >
                                <option value="all">å…¨éƒ¨ç±»å‹</option>
                                <option value="income">æ”¶å…¥</option>
                                <option value="expense">æ”¯å‡º</option>
                            </select>

                            <select
                                value={filters.category}
                                onChange={(e) => setFilters({ ...filters, category: e.target.value })}
                                className="touch-btn px-3 py-2 border border-gray-300 rounded-lg text-sm"
                            >
                                <option value="all">å…¨éƒ¨åˆ†ç±»</option>
                                {[...categories.income, ...categories.expense].map(cat => (
                                    <option key={cat} value={cat}>{cat}</option>
                                ))}
                            </select>
                        </div>
                        
                        <input
                            type="text"
                            value={filters.searchTerm}
                            onChange={(e) => setFilters({ ...filters, searchTerm: e.target.value })}
                            placeholder="æœç´¢å¤‡æ³¨..."
                            className="w-full touch-btn px-3 py-2 border border-gray-300 rounded-lg text-sm"
                        />
                    </div>

                    {/* äº¤æ˜“åˆ—è¡¨ */}
                    <div className="space-y-2">
                        {transactions.length === 0 ? (
                            <div className="bg-white rounded-xl shadow-md p-8 text-center text-gray-400">
                                æš‚æ— äº¤æ˜“è®°å½•
                            </div>
                        ) : (
                            transactions.map(transaction => (
                                <TransactionCard
                                    key={transaction.id}
                                    transaction={transaction}
                                    onEdit={onEdit}
                                    onDelete={onDelete}
                                />
                            ))
                        )}
                    </div>
                </div>
            );
        }

        // äº¤æ˜“å¡ç‰‡
        function TransactionCard({ transaction, onEdit, onDelete }) {
            const [showActions, setShowActions] = useState(false);

            return (
                <div className="bg-white rounded-xl shadow-md p-4 slide-up">
                    <div className="flex items-start justify-between">
                        <div className="flex-1 min-w-0">
                            <div className="flex items-center space-x-2 mb-1">
                                <span className={`px-2 py-0.5 text-xs font-semibold rounded-full ${
                                    transaction.type === 'income'
                                        ? 'bg-green-100 text-green-800'
                                        : 'bg-red-100 text-red-800'
                                }`}>
                                    {transaction.type === 'income' ? 'æ”¶å…¥' : 'æ”¯å‡º'}
                                </span>
                                <span className="text-sm font-medium text-gray-800 truncate">
                                    {transaction.category}
                                </span>
                            </div>
                            
                            <div className="text-xs text-gray-500 mb-1">
                                {transaction.date} Â· {transaction.paymentMethod}
                            </div>
                            
                            {transaction.description && (
                                <div className="text-xs text-gray-600 truncate">
                                    {transaction.description}
                                </div>
                            )}
                        </div>
                        
                        <div className="ml-3 text-right">
                            <div className={`text-lg font-bold ${
                                transaction.type === 'income' ? 'text-green-600' : 'text-red-600'
                            }`}>
                                {transaction.type === 'income' ? '+' : '-'}Â¥{transaction.amount.toFixed(2)}
                            </div>
                            
                            <div className="flex space-x-2 mt-2">
                                <button
                                    onClick={() => onEdit(transaction)}
                                    className="text-xs text-blue-600 touch-btn"
                                >
                                    ç¼–è¾‘
                                </button>
                                <button
                                    onClick={() => onDelete(transaction.id)}
                                    className="text-xs text-red-600 touch-btn"
                                >
                                    åˆ é™¤
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // æŠ¥è¡¨è§†å›¾
        function ReportsView({ statistics }) {
            return (
                <div className="p-4 space-y-4">
                    {/* æ”¶æ”¯å¯¹æ¯” */}
                    <div className="bg-white rounded-xl shadow-md p-4">
                        <h3 className="text-sm font-semibold text-gray-700 mb-4">æ”¶æ”¯å¯¹æ¯”</h3>
                        <div className="space-y-3">
                            <div>
                                <div className="flex justify-between mb-2">
                                    <span className="text-sm text-gray-600">æ”¶å…¥</span>
                                    <span className="text-sm font-semibold text-green-600">
                                        Â¥{statistics.income.toFixed(2)}
                                    </span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-2">
                                    <div
                                        className="bg-green-500 h-2 rounded-full transition-all duration-500"
                                        style={{
                                            width: `${statistics.income / (statistics.income + statistics.expense) * 100 || 0}%`
                                        }}
                                    ></div>
                                </div>
                            </div>
                            <div>
                                <div className="flex justify-between mb-2">
                                    <span className="text-sm text-gray-600">æ”¯å‡º</span>
                                    <span className="text-sm font-semibold text-red-600">
                                        Â¥{statistics.expense.toFixed(2)}
                                    </span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-2">
                                    <div
                                        className="bg-red-500 h-2 rounded-full transition-all duration-500"
                                        style={{
                                            width: `${statistics.expense / (statistics.income + statistics.expense) * 100 || 0}%`
                                        }}
                                    ></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* åˆ†ç±»æ˜ç»† */}
                    <div className="bg-white rounded-xl shadow-md p-4">
                        <h3 className="text-sm font-semibold text-gray-700 mb-4">åˆ†ç±»æ˜ç»†</h3>
                        <div className="space-y-2">
                            {Object.entries(statistics.categoryStats)
                                .sort((a, b) => (b[1].expense + b[1].income) - (a[1].expense + a[1].income))
                                .map(([category, stats]) => {
                                    const total = stats.expense + stats.income;
                                    const maxTotal = Math.max(...Object.values(statistics.categoryStats).map(s => s.expense + s.income));
                                    return (
                                        <div key={category} className="border-b border-gray-100 last:border-0 pb-2">
                                            <div className="flex justify-between mb-1">
                                                <span className="text-sm font-medium text-gray-800">{category}</span>
                                                <span className="text-sm font-bold text-gray-900">
                                                    Â¥{total.toFixed(0)}
                                                </span>
                                            </div>
                                            <div className="w-full bg-gray-200 rounded-full h-1.5">
                                                <div
                                                    className="bg-blue-500 h-1.5 rounded-full transition-all duration-500"
                                                    style={{ width: `${(total / maxTotal) * 100}%` }}
                                                ></div>
                                            </div>
                                            {stats.income > 0 && (
                                                <div className="text-xs text-green-600 mt-1">
                                                    æ”¶å…¥: Â¥{stats.income.toFixed(0)}
                                                </div>
                                            )}
                                            {stats.expense > 0 && (
                                                <div className="text-xs text-red-600 mt-1">
                                                    æ”¯å‡º: Â¥{stats.expense.toFixed(0)}
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                        </div>
                    </div>

                    {/* æœ€è¿‘7å¤©è¶‹åŠ¿ */}
                    <div className="bg-white rounded-xl shadow-md p-4">
                        <h3 className="text-sm font-semibold text-gray-700 mb-4">æœ€è¿‘7å¤©</h3>
                        <div className="space-y-2">
                            {Object.entries(statistics.recentDays).map(([date, stats]) => {
                                const maxAmount = Math.max(stats.income, stats.expense, 1);
                                return (
                                    <div key={date} className="space-y-1">
                                        <div className="flex justify-between text-xs">
                                            <span className="text-gray-600">{date.substring(5)}</span>
                                            <span className={`font-semibold ${
                                                stats.income - stats.expense >= 0 ? 'text-green-600' : 'text-red-600'
                                            }`}>
                                                Â¥{Math.abs(stats.income - stats.expense).toFixed(0)}
                                            </span>
                                        </div>
                                        <div className="flex gap-1 h-4">
                                            <div className="flex-1 bg-gray-100 rounded overflow-hidden">
                                                <div
                                                    className="bg-green-500 h-full transition-all duration-500"
                                                    style={{ width: `${(stats.income / maxAmount) * 100}%` }}
                                                ></div>
                                            </div>
                                            <div className="flex-1 bg-gray-100 rounded overflow-hidden">
                                                <div
                                                    className="bg-red-500 h-full transition-all duration-500"
                                                    style={{ width: `${(stats.expense / maxAmount) * 100}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        }

        // è®¾ç½®è§†å›¾
        function SettingsView({ transactions, setTransactions, categories, setCategories }) {
            const exportData = () => {
                const dataStr = JSON.stringify({
                    transactions,
                    categories,
                    exportDate: new Date().toISOString()
                }, null, 2);
                
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `è´¢åŠ¡è®°å½•_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            if (data.transactions) setTransactions(data.transactions);
                            if (data.categories) setCategories(data.categories);
                            alert('å¯¼å…¥æˆåŠŸï¼');
                        } catch (error) {
                            alert('å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶æ ¼å¼é”™è¯¯');
                        }
                    };
                    reader.readAsText(file);
                }
            };

            const clearAllData = () => {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    setTransactions([]);
                    setCategories(DEFAULT_CATEGORIES);
                    alert('æ•°æ®å·²æ¸…ç©º');
                }
            };

            return (
                <div className="p-4 space-y-4">
                    <div className="bg-white rounded-xl shadow-md divide-y">
                        <button
                            onClick={() => document.getElementById('importFile').click()}
                            className="w-full touch-btn px-4 py-4 text-left flex items-center justify-between active:bg-gray-50"
                        >
                            <span className="text-sm font-medium">ğŸ“¥ å¯¼å…¥æ•°æ®</span>
                            <span className="text-gray-400">â€º</span>
                        </button>
                        <input
                            id="importFile"
                            type="file"
                            accept=".json"
                            onChange={importData}
                            className="hidden"
                        />
                        
                        <button
                            onClick={exportData}
                            className="w-full touch-btn px-4 py-4 text-left flex items-center justify-between active:bg-gray-50"
                        >
                            <span className="text-sm font-medium">ğŸ“¤ å¯¼å‡ºæ•°æ®</span>
                            <span className="text-gray-400">â€º</span>
                        </button>
                        
                        <button
                            onClick={clearAllData}
                            className="w-full touch-btn px-4 py-4 text-left flex items-center justify-between active:bg-gray-50"
                        >
                            <span className="text-sm font-medium text-red-600">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®</span>
                            <span className="text-gray-400">â€º</span>
                        </button>
                    </div>

                    <div className="bg-white rounded-xl shadow-md p-4">
                        <h3 className="text-sm font-semibold text-gray-700 mb-3">æ•°æ®ç»Ÿè®¡</h3>
                        <div className="space-y-2 text-sm text-gray-600">
                            <div className="flex justify-between">
                                <span>æ€»è®°å½•æ•°</span>
                                <span className="font-medium">{transactions.length}</span>
                            </div>
                            <div className="flex justify-between">
                                <span>æ”¶å…¥åˆ†ç±»</span>
                                <span className="font-medium">{categories.income.length}</span>
                            </div>
                            <div className="flex justify-between">
                                <span>æ”¯å‡ºåˆ†ç±»</span>
                                <span className="font-medium">{categories.expense.length}</span>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-xl shadow-md p-4">
                        <h3 className="text-sm font-semibold text-gray-700 mb-3">å…³äº</h3>
                        <div className="text-xs text-gray-500 space-y-1">
                            <p>ç‰ˆæœ¬: 1.0.0</p>
                            <p>å°ä¼ä¸šè´¢åŠ¡è®°è´¦ç³»ç»Ÿ</p>
                            <p>æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­</p>
                        </div>
                    </div>
                </div>
            );
        }

        // äº¤æ˜“æ¨¡æ€æ¡† - ç§»åŠ¨ç«¯ä¼˜åŒ–
        function TransactionModal({ formData, setFormData, categories, setCategories, onSubmit, onClose, isEditing }) {
            const addCategory = () => {
                const newCategory = prompt(`è¯·è¾“å…¥æ–°çš„${formData.type === 'income' ? 'æ”¶å…¥' : 'æ”¯å‡º'}åˆ†ç±»ï¼š`);
                if (newCategory && newCategory.trim()) {
                    setCategories({
                        ...categories,
                        [formData.type]: [...categories[formData.type], newCategory.trim()]
                    });
                    setFormData({ ...formData, category: newCategory.trim() });
                }
            };

            return (
                <>
                    <div className="modal-overlay" onClick={onClose}></div>
                    <div className="modal-content slide-up">
                        <div className="p-4">
                            {/* æ‹–åŠ¨æ¡ */}
                            <div className="flex justify-center mb-4">
                                <div className="w-12 h-1 bg-gray-300 rounded-full"></div>
                            </div>

                            <h2 className="text-xl font-bold text-gray-800 mb-4">
                                {isEditing ? 'ç¼–è¾‘è®°å½•' : 'æ–°å»ºè®°å½•'}
                            </h2>

                            <form onSubmit={onSubmit} className="space-y-4">
                                {/* ç±»å‹é€‰æ‹© */}
                                <div className="grid grid-cols-2 gap-3">
                                    <button
                                        type="button"
                                        onClick={() => setFormData({ ...formData, type: 'income', category: '' })}
                                        className={`touch-btn py-4 rounded-xl border-2 transition ${
                                            formData.type === 'income'
                                                ? 'border-green-500 bg-green-50 text-green-700'
                                                : 'border-gray-200 text-gray-600'
                                        }`}
                                    >
                                        <div className="text-3xl mb-1">ğŸ’°</div>
                                        <div className="text-sm font-medium">æ”¶å…¥</div>
                                    </button>
                                    <button
                                        type="button"
                                        onClick={() => setFormData({ ...formData, type: 'expense', category: '' })}
                                        className={`touch-btn py-4 rounded-xl border-2 transition ${
                                            formData.type === 'expense'
                                                ? 'border-red-500 bg-red-50 text-red-700'
                                                : 'border-gray-200 text-gray-600'
                                        }`}
                                    >
                                        <div className="text-3xl mb-1">ğŸ’¸</div>
                                        <div className="text-sm font-medium">æ”¯å‡º</div>
                                    </button>
                                </div>

                                {/* é‡‘é¢ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">é‡‘é¢ *</label>
                                    <div className="relative">
                                        <span className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 text-lg">Â¥</span>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={formData.amount}
                                            onChange={(e) => setFormData({ ...formData, amount: e.target.value })}
                                            className="w-full touch-btn pl-10 pr-4 py-3 border-2 border-gray-300 rounded-xl text-lg focus:border-blue-500 focus:outline-none"
                                            placeholder="0.00"
                                            required
                                            inputMode="decimal"
                                        />
                                    </div>
                                </div>

                                {/* åˆ†ç±» */}
                                <div>
                                    <div className="flex justify-between items-center mb-2">
                                        <label className="text-sm font-medium text-gray-700">åˆ†ç±» *</label>
                                        <button
                                            type="button"
                                            onClick={addCategory}
                                            className="text-xs text-blue-600 touch-btn"
                                        >
                                            â• æ–°å¢
                                        </button>
                                    </div>
                                    <select
                                        value={formData.category}
                                        onChange={(e) => setFormData({ ...formData, category: e.target.value })}
                                        className="w-full touch-btn px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none"
                                        required
                                    >
                                        <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
                                        {categories[formData.type].map(cat => (
                                            <option key={cat} value={cat}>{cat}</option>
                                        ))}
                                    </select>
                                </div>

                                {/* æ—¥æœŸ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">æ—¥æœŸ *</label>
                                    <input
                                        type="date"
                                        value={formData.date}
                                        onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                                        className="w-full touch-btn px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none"
                                        required
                                    />
                                </div>

                                {/* æ”¯ä»˜æ–¹å¼ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">æ”¯ä»˜æ–¹å¼</label>
                                    <select
                                        value={formData.paymentMethod}
                                        onChange={(e) => setFormData({ ...formData, paymentMethod: e.target.value })}
                                        className="w-full touch-btn px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none"
                                    >
                                        <option value="ç°é‡‘">ç°é‡‘</option>
                                        <option value="é“¶è¡Œå¡">é“¶è¡Œå¡</option>
                                        <option value="æ”¯ä»˜å®">æ”¯ä»˜å®</option>
                                        <option value="å¾®ä¿¡">å¾®ä¿¡</option>
                                        <option value="å…¶ä»–">å…¶ä»–</option>
                                    </select>
                                </div>

                                {/* å¤‡æ³¨ */}
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">å¤‡æ³¨</label>
                                    <textarea
                                        value={formData.description}
                                        onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                                        className="w-full touch-btn px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none resize-none"
                                        rows="3"
                                        placeholder="æ·»åŠ å¤‡æ³¨ä¿¡æ¯..."
                                    />
                                </div>

                                {/* æŒ‰é’® */}
                                <div className="flex space-x-3 pt-2">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="flex-1 touch-btn py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-medium active:scale-95 transition"
                                    >
                                        å–æ¶ˆ
                                    </button>
                                    <button
                                        type="submit"
                                        className="flex-1 touch-btn py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-medium shadow-lg active:scale-95 transition"
                                    >
                                        {isEditing ? 'ä¿å­˜' : 'æ·»åŠ '}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </>
            );
        }

        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(<FinanceTracker />, document.getElementById('root'));
    </script>
</body>
</html>
